From: =?utf-8?b?Ik1hcmNvIFRyZXZpc2FuIChUcmV2acOxbyki?= <mail@3v1n0.net>
Date: Thu, 3 Oct 2024 21:51:16 +0200
Subject: Revert "split-row: Recolor the illustration with accent color"

This reverts commit 22e806c3191fad42fab92e282e0277f1da5db75f.
---
 panels/common/cc-split-row.c  | 52 +++++++++----------------------------------
 panels/common/cc-split-row.ui |  6 -----
 2 files changed, 10 insertions(+), 48 deletions(-)

diff --git a/panels/common/cc-split-row.c b/panels/common/cc-split-row.c
index ea0a7d6..5986527 100644
--- a/panels/common/cc-split-row.c
+++ b/panels/common/cc-split-row.c
@@ -22,8 +22,6 @@
 
 #include "cc-split-row.h"
 
-#include "cc-mask-paintable.h"
-
 struct _CcSplitRow
 {
   CcVerticalRow      parent;
@@ -34,9 +32,6 @@ struct _CcSplitRow
   GtkPicture        *default_option_picture;
   GtkPicture        *alternative_option_picture;
 
-  CcMaskPaintable   *default_option_mask;
-  CcMaskPaintable   *alternative_option_mask;
-
   GtkCheckButton    *alternative_option_checkbutton;
   GtkCheckButton    *default_option_checkbutton;
 
@@ -83,12 +78,12 @@ on_alternative_option_click_released_cb (CcSplitRow *self)
 }
 
 static void
-focus_leave (CcMaskPaintable *mask)
+focus_leave (GtkPicture *picture)
 {
   GtkMediaStream *stream;
   GdkPaintable *paintable;
 
-  paintable = cc_mask_paintable_get_paintable (mask);
+  paintable = gtk_picture_get_paintable (picture);
 
   if (!GTK_IS_MEDIA_STREAM (paintable))
     return;
@@ -101,22 +96,22 @@ focus_leave (CcMaskPaintable *mask)
 static void
 on_default_option_focus_leave_cb (CcSplitRow *self)
 {
-  focus_leave (self->default_option_mask);
+  focus_leave (self->default_option_picture);
 }
 
 static void
 on_alternative_option_focus_leave_cb (CcSplitRow *self)
 {
-  focus_leave (self->alternative_option_mask);
+  focus_leave (self->alternative_option_picture);
 }
 
 static void
-focus_enter (CcMaskPaintable *mask)
+focus_enter (GtkPicture *picture)
 {
   GtkMediaStream *stream;
   GdkPaintable *paintable;
 
-  paintable = cc_mask_paintable_get_paintable (mask);
+  paintable = gtk_picture_get_paintable (picture);
 
   if (!GTK_IS_MEDIA_STREAM (paintable))
     return;
@@ -129,13 +124,13 @@ focus_enter (CcMaskPaintable *mask)
 static void
 on_default_option_focus_enter_cb (CcSplitRow *self)
 {
-  focus_enter (self->default_option_mask);
+  focus_enter (self->default_option_picture);
 }
 
 static void
 on_alternative_option_focus_enter_cb (CcSplitRow *self)
 {
-  focus_enter (self->alternative_option_mask);
+  focus_enter (self->alternative_option_picture);
 }
 
 static void
@@ -144,20 +139,6 @@ on_checkbutton_toggled_cb (CcSplitRow *self)
   g_object_notify_by_pspec (G_OBJECT (self), props[PROP_USE_DEFAULT]);
 }
 
-static void
-update_mask_color (CcSplitRow *self)
-{
-  AdwStyleManager *style_manager = adw_style_manager_get_default ();
-  AdwAccentColor color;
-  GdkRGBA rgba;
-
-  color = adw_style_manager_get_accent_color (style_manager);
-  adw_accent_color_to_rgba (color, &rgba);
-
-  cc_mask_paintable_set_rgba (self->default_option_mask, &rgba);
-  cc_mask_paintable_set_rgba (self->alternative_option_mask, &rgba);
-}
-
 static void
 cc_split_row_dispose (GObject *object)
 {
@@ -320,10 +301,8 @@ cc_split_row_class_init (CcSplitRowClass *klass)
   gtk_widget_class_bind_template_child (widget_class, CcSplitRow, size_group);
   gtk_widget_class_bind_template_child (widget_class, CcSplitRow, alternative_option_checkbutton);
   gtk_widget_class_bind_template_child (widget_class, CcSplitRow, alternative_option_picture);
-  gtk_widget_class_bind_template_child (widget_class, CcSplitRow, alternative_option_mask);
   gtk_widget_class_bind_template_child (widget_class, CcSplitRow, default_option_checkbutton);
   gtk_widget_class_bind_template_child (widget_class, CcSplitRow, default_option_picture);
-  gtk_widget_class_bind_template_child (widget_class, CcSplitRow, default_option_mask);
 
   gtk_widget_class_bind_template_callback (widget_class, on_checkbutton_toggled_cb);
   gtk_widget_class_bind_template_callback (widget_class, on_default_option_click_released_cb);
@@ -337,20 +316,9 @@ cc_split_row_class_init (CcSplitRowClass *klass)
 static void
 cc_split_row_init (CcSplitRow *self)
 {
-  AdwStyleManager *style_manager = adw_style_manager_get_default ();
-
   gtk_widget_init_template (GTK_WIDGET (self));
   gtk_widget_set_name (GTK_WIDGET (self), "split-row");
   gtk_widget_add_css_class (GTK_WIDGET (self), "split-row");
-
-  update_mask_color (self);
-
-  g_signal_connect_object (style_manager, "notify::dark",
-                           G_CALLBACK (update_mask_color), self,
-                           G_CONNECT_SWAPPED);
-  g_signal_connect_object (style_manager, "notify::accent-color",
-                           G_CALLBACK (update_mask_color), self,
-                           G_CONNECT_SWAPPED);
 }
 
 const gchar *
@@ -370,7 +338,7 @@ cc_split_row_set_default_illustration_resource (CcSplitRow  *self,
   g_set_str (&self->default_resource_path, resource_path);
   media_file = gtk_media_file_new_for_resource (resource_path);
 
-  cc_mask_paintable_set_paintable (self->default_option_mask, GDK_PAINTABLE (media_file));
+  gtk_picture_set_paintable (self->default_option_picture, GDK_PAINTABLE (media_file));
   gtk_widget_set_visible (GTK_WIDGET (self->default_option_picture),
                           resource_path != NULL && g_strcmp0 (resource_path, "") != 0);
 
@@ -395,7 +363,7 @@ cc_split_row_set_alternative_illustration_resource (CcSplitRow  *self,
   media_file = gtk_media_file_new_for_resource (resource_path);
   gtk_media_stream_set_loop (media_file, TRUE);
 
-  cc_mask_paintable_set_paintable (self->alternative_option_mask, GDK_PAINTABLE (media_file));
+  gtk_picture_set_paintable (self->alternative_option_picture, GDK_PAINTABLE (media_file));
   gtk_widget_set_visible (GTK_WIDGET (self->alternative_option_picture),
                           resource_path != NULL && g_strcmp0 (resource_path, "") != 0);
 
diff --git a/panels/common/cc-split-row.ui b/panels/common/cc-split-row.ui
index b4e8e58..540b3bb 100644
--- a/panels/common/cc-split-row.ui
+++ b/panels/common/cc-split-row.ui
@@ -43,9 +43,6 @@
                     <property name="margin-start">6</property>
                     <property name="margin-end">6</property>
                     <property name="height-request">128</property>
-                    <property name="paintable">
-                      <object class="CcMaskPaintable" id="default_option_mask"/>
-                    </property>
                   </object>
                 </child>
               </object>
@@ -130,9 +127,6 @@
                     <property name="margin-start">6</property>
                     <property name="margin-end">6</property>
                     <property name="height-request">128</property>
-                    <property name="paintable">
-                      <object class="CcMaskPaintable" id="alternative_option_mask"/>
-                    </property>
                   </object>
                 </child>
               </object>
